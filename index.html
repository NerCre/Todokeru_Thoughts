<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <!-- アプリ名称を改定 -->
    <title>想をトドケル</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app" class="app">
      <!-- Top bar: back & logout shown on non-login views -->
      <header id="topbar" class="topbar" aria-label="操作バー">
        <button id="btnBack" class="icon-btn" type="button" aria-label="戻る">
          <!-- Left arrow icon -->
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M15.5 5.5 9 12l6.5 6.5-1.4 1.4L6.2 12l7.9-7.9 1.4 1.4z" />
          </svg>
          <span>戻る</span>
        </button>
        <div id="topbarTitle" class="topbar-title" aria-hidden="true">
          想をトドケル
        </div>
        <button id="btnLogout" class="icon-btn" type="button" aria-label="終了">
          <!-- Logout/restart icon -->
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M17.65 6.35A7.95 7.95 0 0 0 12 4V1L7 6l5 5V7a6 6 0 1 1-6 6H4a8 8 0 1 0 13.65-6.65z"
            />
          </svg>
          <span>終了</span>
        </button>
      </header>

      <main class="main">
        <!-- Login view -->
        <section id="view-login" class="view active" aria-label="ログイン">
          <div class="hero">
            <div class="mascot">
              <img
                src="トドケルちゃん.png"
                alt="トドケルちゃんのキャラクター"
              />
            </div>
            <!-- アプリタイトルを変更 -->
            <h1 class="app-title">想をトドケル</h1>
            <p class="tagline">安全課が救命情報を迅速に提供するためのアプリです。</p>
          </div>

          <div class="login-forms">
            <!-- ユーザーログイン -->
            <div class="login-section">
              <h2>ユーザーログイン</h2>
              <div class="input-group">
                <label for="userPassword">パスワード</label>
                <input
                  id="userPassword"
                  type="password"
                  autocomplete="current-password"
                />
              </div>
              <button id="btnUserLogin" class="btn btn-primary" type="button">
                ログイン
              </button>
            </div>

            <!-- 管理者ログイン入り口。クリックすると下のフォームが表示されます -->
            <div class="login-section admin-entry">
              <button id="btnAdminEntry" class="link-btn" type="button">
                管理者ログイン
              </button>
            </div>

            <!-- 管理者ログインフォーム。初期状態では非表示 -->
            <div id="adminLoginSection" class="login-section hidden">
              <h2>管理者ログイン</h2>
              <div class="input-group">
                <label for="adminId">ID</label>
                <input id="adminId" type="text" autocomplete="username" />
              </div>
              <div class="input-group">
                <label for="adminPassword">パスワード</label>
                <input
                  id="adminPassword"
                  type="password"
                  autocomplete="current-password"
                />
              </div>
              <button id="btnAdminLogin" class="btn btn-primary" type="button">
                ログイン
              </button>
            </div>
          </div>
        </section>

        <!-- Input view -->
        <section id="view-input" class="view" aria-label="照合入力">
          <h2>SMSを貼り付けて照合</h2>
          <div class="input-group">
            <label for="smsInput">SMS本文</label>
            <textarea
              id="smsInput"
              rows="4"
              placeholder="ここにSMS内容を貼り付けてください"
            ></textarea>
          </div>
          <div class="input-group">
            <label for="empId">職員ID</label>
            <input id="empId" type="text" placeholder="IDを入力してください" />
          </div>
          <!-- 職員IDがない場合の補助ボタン -->
          <div class="form-row" style="margin-bottom:10px; gap:8px;">
            <button id="btnScanHelmet" class="btn btn-secondary" type="button">ヘルメットQRを読む</button>
            <button id="btnSearchName" class="btn btn-secondary" type="button">氏名で探す</button>
          </div>
          <button id="btnMatch" class="btn btn-primary" type="button">
            照合する
          </button>
          <button id="btnClear" class="btn btn-secondary" type="button" style="margin-top:8px;">
            クリア
          </button>
          <p class="small muted">
            ※ SMS本文から自動でIDを抽出しますが、手動で修正できます。
          </p>
        </section>

        <!-- Result view -->
        <section id="view-result" class="view" aria-label="職員情報">
          <h2>職員情報</h2>
          <!-- ツナグSMSから読み取った情報 -->
          <div id="tunaguInfoCard" class="result-card"></div>
          <!-- トドケルマスタからの情報 -->
          <div id="todokeruInfoCard" class="result-card" style="margin-top:12px;"></div>
          <!-- ボタン群 -->
          <div class="result-actions" style="margin-top:16px; display:flex; flex-direction:column; gap:8px;">
            <button id="btnEditTunagu" class="btn btn-primary" type="button">ツナゲル情報の編集</button>
            <button id="btnShowcase" class="btn btn-primary" type="button">照会モード</button>
            <button id="btnEndShowcase" class="btn btn-secondary" type="button">照会を終わる</button>
            <button id="btnResultBack" class="btn btn-secondary" type="button">戻る</button>
          </div>
        </section>

        <!-- ツナゲル情報編集ビュー -->
        <section id="view-edit-tsunagu" class="view" aria-label="ツナゲル情報編集">
          <h2>ツナゲル情報編集</h2>
          <div class="input-group">
            <label for="editContactTime">連絡時間</label>
            <input id="editContactTime" type="text" disabled />
          </div>
          <!-- 職員IDとスキャン/検索ボタン -->
          <div class="input-group">
            <label for="editEmpId">職員ID</label>
            <input id="editEmpId" type="text" disabled />
            <div class="form-row" style="margin-top:8px; gap:8px;">
              <button id="btnEditScanHelmet" class="btn btn-secondary" type="button">ヘルメットQRを読む</button>
              <button id="btnEditSearchName" class="btn btn-secondary" type="button">氏名で探す</button>
            </div>
          </div>
          <!-- 場所とQR/地図選択ボタン -->
          <div class="input-group">
            <label for="editLocation">場所</label>
            <input id="editLocation" type="text" />
            <div class="form-row" style="margin-top:8px; gap:8px;">
              <button id="btnEditScanLocation" class="btn btn-secondary" type="button">場所QRを読む</button>
              <button id="btnEditMapSelect" class="btn btn-secondary" type="button">地図から選択</button>
            </div>
          </div>
          <div class="input-group">
            <label for="editStatus1">状態1</label>
            <input id="editStatus1" type="text" placeholder="例：意識なし" />
          </div>
          <div class="input-group">
            <label for="editStatus2">状態2</label>
            <input id="editStatus2" type="text" placeholder="例：呼吸なし、大量出血なし、強い痛み不明" />
          </div>
          <div class="input-group">
            <label for="editAccident">事故種別</label>
            <input id="editAccident" type="text" placeholder="例：挟まれ、感電" />
          </div>
          <div class="form-row" style="margin-top:16px; gap:8px;">
            <button id="btnEditDone" class="btn btn-primary" type="button">編集を終わる</button>
            <button id="btnEditCancel" class="btn btn-secondary" type="button">戻る</button>
          </div>
        </section>

        <!-- 照会モードビュー -->
        <section id="view-showcase" class="view" aria-label="照会モード">
          <h2>照会モード</h2>
          <p class="small muted" style="margin-bottom:12px;">職員以外の方は、スクロールのみ行ってください。</p>
          <div id="showcaseCard" class="result-card"></div>
          <p class="small" style="margin-top:12px; color: var(--muted);">※職員のみが操作してください</p>
          <button id="btnShowcaseEnd" class="btn btn-secondary" type="button" style="margin-top:12px;">照会モードを終了</button>
        </section>

        <!-- Admin view -->
        <section id="view-admin" class="view" aria-label="マスタ設定">
          <h2>マスタデータ設定</h2>
          <div class="admin-actions">
            <button id="btnAddStaff" class="btn btn-primary" type="button">
              新規追加
            </button>
            <button id="btnExport" class="btn btn-secondary" type="button">
              エクスポート
            </button>
            <label for="importFile" class="btn btn-secondary">
              インポート
              <input type="file" id="importFile" accept=".json" hidden />
            </label>
          </div>
          <table id="staffTable" class="staff-table">
            <thead>
              <tr>
                <th style="width: 25%">生年月日</th>
                <th style="width: 45%">氏名</th>
                <th style="width: 30%">操作</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <hr />
          <h3>パスワード設定</h3>
          <div class="input-group">
            <label for="newUserPassword">利用者パスワード</label>
            <input id="newUserPassword" type="password" />
          </div>
          <button
            id="btnSetUserPassword"
            class="btn btn-primary"
            type="button"
          >
            更新
          </button>
          <div class="input-group">
            <label for="newAdminId">管理者ID</label>
            <input id="newAdminId" type="text" />
          </div>
          <div class="input-group">
            <label for="newAdminPassword">管理者パスワード</label>
            <input id="newAdminPassword" type="password" />
          </div>
          <button
            id="btnSetAdminCredentials"
            class="btn btn-primary"
            type="button"
          >
            更新
          </button>

          <!-- Modal for staff add/edit -->
          <div id="staffFormContainer" class="modal hidden">
            <div class="modal-content">
              <h3 id="staffFormTitle">職員情報</h3>
              <div class="input-group">
                <label for="staffBirthday">生年月日</label>
                <input id="staffBirthday" type="text" placeholder="例：1990/01/01" />
              </div>
              <!-- ID は内部的に保持し、表示しない -->
              <input id="staffId" type="hidden" />
              <div class="input-group">
                <label for="staffName">氏名</label>
                <input id="staffName" type="text" />
              </div>
              <div class="input-group">
                <label for="staffBlood">血液型</label>
                <input id="staffBlood" type="text" />
              </div>
              <div class="input-group">
                <label for="staffHistory">既往歴（カンマ区切り）</label>
                <input id="staffHistory" type="text" />
              </div>
              <div class="input-group">
                <label for="staffMeds">薬剤情報（カンマ区切り）</label>
                <input id="staffMeds" type="text" />
              </div>
              <div class="input-group">
                <label for="staffAllergy">アレルギー（カンマ区切り）</label>
                <input id="staffAllergy" type="text" />
              </div>
              <div class="input-group">
                <label for="staffDoctor">かかりつけ医</label>
                <input id="staffDoctor" type="text" />
              </div>
              <div class="input-group">
                <label for="staffContactRel">緊急連絡先（続柄）</label>
                <input id="staffContactRel" type="text" />
              </div>
              <div class="input-group">
                <label for="staffContactTel">緊急連絡先（電話番号）</label>
                <input id="staffContactTel" type="text" />
              </div>
              <div class="modal-actions">
                <button id="btnSaveStaff" class="btn btn-primary" type="button">
                  保存
                </button>
                <button id="btnCancelStaff" class="btn btn-secondary" type="button">
                  キャンセル
                </button>
              </div>
            </div>
          </div>
        </section>
        <!-- 地図選択モーダル -->
        <div id="mapModal" class="modal hidden">
          <div class="modal-content">
            <h3 style="margin-top:0; margin-bottom:8px;">地図から場所を選択</h3>
            <img src="map_overview.png" alt="全体地図" style="width:100%;height:auto;border-radius:8px;margin-bottom:8px;" />
            <div class="form-row" style="gap:8px; margin-bottom:8px;">
              <button class="btn btn-secondary map-area-btn" data-area="1" type="button">エリア1</button>
              <button class="btn btn-secondary map-area-btn" data-area="2" type="button">エリア2</button>
              <button class="btn btn-secondary map-area-btn" data-area="3" type="button">エリア3</button>
            </div>
            <img id="mapDetailImg" src="" alt="エリア詳細" style="width:100%;height:auto;border-radius:8px;display:none;" />
            <div class="modal-actions">
              <button id="btnMapSelectCancel" class="btn btn-secondary" type="button">キャンセル</button>
            </div>
          </div>
        </div>

      </main>
      <div id="toast" class="toast"></div>
    </div>
    <script src="script.js"></script>
  </body>
</html>